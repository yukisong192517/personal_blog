# 像极了爱情的网络协议

人们都说TCP是面向连接的,UDP是面向无连接的。那么问题来了什么是连接？

## UDP & TCP的区别

### 建立连接



* 建立连接

> 一种网络协议,依赖发送方和接收器之间的显示通信和阻塞以管理双方的数据传输.网络系统需要在两台计算机之间发送数据之前先建立连接的一种特性。面向连接网络类似于电话系统，在开始通信前必须先进行一次呼叫和应答。

* 普通话版本

可以把客户端和服务端想成锡纸烫和大波浪，这两个人如果想合法的嘿嘿嘿，首先要互相确认关系，然后步入婚姻的殿堂，然后才能嘿嘿嘿。所以建立连接就是
为了维护双方交互的状态，需要一定的数据结构来保证这个特性，这个特性就是面向连接的特性。

可以认为TCP是靠谱的高端婚介会所，提供可靠交付，保证大波浪和锡纸烫之间爱情小火花无差错，不丢失，不重复，按顺序到达。而UDP就是混乱的night club
男男女女之间的嘿嘿嘿和小火花是不稳定的，不保证按顺序到达，不保证不丢失


### 面向字节流

发送的时候发的是流，ip包是一个个的包，tcp通过自己的结构维护成了流。
UDP则继承了ip的特性，基于数据报，一个一个的发，一个个的收

### 拥塞控制

TCP就像有场控的婚介，可以控制发送的行为，当包丢了，或者网络环境不好了，tcp则会调整自己的行为。而UDP就不会，露天club，多多益善，发使劲发，都给老子发出去。

### 有状态的服务

TCP明确的记录了发送状态，接受状态。而UDP则是没有状态，发出去就发出去了，后面的，对不起和我UDP 没有关系。

 
## UDP

### 包头

UDP 的包头有： 源端口号，目标端口号，udp长度，校验和，数据。

可以看出这个结构简直简单的很，所以沟通简单。而且谁都可以发谁都可以收，没有拥塞等字段来控制。

### 使用场景

1. 内网
2. 组播多播的需要的时候 DHCP，VXLAN
3. http 3 的 QUIC 
4. 流媒体： 视频直播
5. 实时对战游戏
6. 移动通信。


## TCP

### 包头

TCP的包头由下面的几个部分组成： 源端口号，目标端口号，序号，确认序号，首部长度，状态位：syn/ack/fin/rst/psh/urg等，窗口大小，
校验和，紧急指针，数据组成

可以看到包头要比udp复杂的多。那么这些部分有什么用？
1. 顺序问题，序号确定发出顺序，确认序号确定接受顺序
2. 丢包重传，根据确认序号确定重传的问题。
3. 链接维护，状态位用来维护链接。
4. 拥塞控制： 根据窗口大小调整接受能力
5. 流量控制：根据窗口大小，调整发送能力



